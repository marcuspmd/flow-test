# Reporting Guide

Flow Test Engine generates a comprehensive JSON report after each execution. This file serves as the source of truth for integrations, dashboards, and CI/CD pipelines. HTML visualization is now handled exclusively through the built-in dashboard system.

## JSON Results

The `results/latest.json` file contains all execution details, including metrics, suites, steps, and final variables.

```json
{
  "project_name": "My API Tests",
  "start_time": "2025-09-21T10:51:16.787Z",
  "end_time": "2025-09-21T10:51:18.841Z",
  "total_duration_ms": 2054,
  "total_tests": 32,
  "successful_tests": 32,
  "failed_tests": 0,
  "success_rate": 100,
  "suites_results": [
    {
      "node_id": "auth-tests",
      "suite_name": "Authentication Tests",
      "status": "success",
      "duration_ms": 1250,
      "steps_results": [
        {
          "step_name": "Login with valid credentials",
          "status": "success",
          "duration_ms": 420
        }
      ]
    }
  ],
  "report_metadata": {
    "generated_at": "2025-09-21T10:51:18.841Z",
    "format": "json",
    "version": "1.1.1"
  }
}
```

## Dashboard (HTML Viewer)

The dashboard is built with Astro and Tailwind CSS. It reads `results/latest.json` and provides a complete web interface with filters, charts, and step inspection.

### Dashboard Commands

```bash
# Install dashboard dependencies (first time only)
flow-test dashboard install

# Start development server with hot reload
flow-test dashboard dev

# Build static dashboard for deployment
flow-test dashboard build

# Preview the built dashboard
flow-test dashboard preview

# Build and serve dashboard (production mode)
flow-test dashboard serve
```

The dashboard automatically locates and reads the latest results file. You can access it at `http://localhost:4321` when running in development mode.

## Configuration in flow-test.config.yml

```yaml
reporting:
  formats: ["json"]              # Only format supported by the engine
  output_dir: "./results"        # Where latest.json will be saved
  aggregate: true                # Maintains global aggregations
  include_performance_metrics: true
  include_variables_state: true
```

> ℹ️ The engine only supports JSON format. Other formats in the configuration will be ignored.

## Usage in CI/CD

The minimal requirement is to persist `results/latest.json` as an artifact. If you want to publish the static dashboard, run the build after the tests.

### GitHub Actions

```yaml
name: API Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm ci

      - name: Run Flow Tests
        run: flow-test --priority critical,high

      - name: Upload test results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-results
          path: results/latest.json

      - name: Build dashboard
        if: always()
        run: |
          flow-test dashboard install
          flow-test dashboard build

      - name: Deploy dashboard to GitHub Pages
        if: github.ref == 'refs/heads/main'
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./report-dashboard/dist
```
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npm test

      - name: Build dashboard (optional)
        run: npm run report:dashboard:build

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: flow-test-results
          path: |
            results/latest.json
            report-dashboard/dist
```

### Jenkins Pipeline

```groovy
pipeline {
  agent any

  stages {
    stage('Install') {
      steps {
        sh 'npm install'
      }
    }

    stage('Test') {
      steps {
        sh 'npm test'
      }
    }

    stage('Build Dashboard') {
      steps {
        sh 'npm run report:dashboard:build'
      }
    }
  }

  post {
    always {
      archiveArtifacts artifacts: 'results/latest.json'
      archiveArtifacts artifacts: 'report-dashboard/dist/**', fingerprint: true
    }
  }
}
```

## Customização do Dashboard

Todo o código visual mora em `report-dashboard/src/`. Lá você pode alterar componentes, temas e integrações com analytics. O engine principal se limita a persistir o JSON.

- Ajuste estilos em `report-dashboard/src/styles/`.
- Adicione widgets novos em `report-dashboard/src/components/`.
- Atualize `report-dashboard/astro.config.mjs` para mudar base path ou integrações.

## Checklist Rápido

- [x] Rode os testes (`npm test`) → garante `results/latest.json` atualizado.
- [x] Opcional: `npm run report:dashboard:build` para gerar versão estática.
- [x] Publique os artefatos desejados (JSON e/ou build estático).
- [x] Compartilhe o link do dashboard ou anexe o JSON no MR/PR.
