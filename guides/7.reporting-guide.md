# Reporting Guide

O Flow Test Engine gera um artefato JSON completo após cada execução. Esse arquivo é a fonte de verdade para integrações, dashboards e pipelines. A visualização em HTML agora acontece exclusivamente via o projeto `report-dashboard`, que consome `results/latest.json`.

## JSON Results

O arquivo `results/latest.json` contém todos os detalhes da execução, incluindo métricas, suites, passos e variáveis finais.

```json
{
  "project_name": "My API Tests",
  "start_time": "2025-09-17T10:51:16.787Z",
  "end_time": "2025-09-17T10:51:18.841Z",
  "total_duration_ms": 2054,
  "total_tests": 32,
  "successful_tests": 32,
  "failed_tests": 0,
  "success_rate": 100,
  "suites_results": [
    {
      "node_id": "auth-tests",
      "suite_name": "Authentication Tests",
      "status": "success",
      "duration_ms": 1250,
      "steps_results": [
        {
          "step_name": "Login with valid credentials",
          "status": "success",
          "duration_ms": 420
        }
      ]
    }
  ],
  "report_metadata": {
    "generated_at": "2025-09-17T10:51:18.841Z",
    "format": "json",
    "version": "1.0.0"
  }
}
```

## Report Dashboard (HTML Viewer)

O dashboard vive em `report-dashboard/` (Astro + Tailwind). Ele lê `results/latest.json` e renderiza uma experiência completa com filtros, gráficos e inspeção de passos.

```bash
npm run report:dashboard:install  # instala dependências do dashboard
npm run report:dashboard:dev      # abre http://localhost:4321 com hot reload
npm run report:dashboard:build    # gera build estático em report-dashboard/dist
npm run report:dashboard:preview  # pré-visualiza o build estático
```

Por padrão o dashboard procura `../results/latest.json`. Se desejar apontar para outro arquivo, use a flag `--results=<caminho>` ao iniciar o dev server (`npm run report:dashboard:dev -- --results ../results/custom.json`).

## Configuração no flow-test.config.yml

```yaml
reporting:
  formats: ["json"]           # único formato suportado pelo engine
  output_dir: "./results"     # onde latest.json será salvo
  aggregate: true              # mantém agregados globais
  include_performance_metrics: true
  include_variables_state: true
```

> ℹ️  Caso o campo `formats` esteja vazio ou inclua outros valores, o engine interrompe a execução com erro de validação.

## Uso em CI/CD

O passo mínimo é persistir `results/latest.json` como artefato. Se quiser publicar o dashboard estático, execute o build após os testes.

### GitHub Actions

```yaml
name: API Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Run tests
        run: npm test

      - name: Build dashboard (optional)
        run: npm run report:dashboard:build

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: flow-test-results
          path: |
            results/latest.json
            report-dashboard/dist
```

### Jenkins Pipeline

```groovy
pipeline {
  agent any

  stages {
    stage('Install') {
      steps {
        sh 'npm install'
      }
    }

    stage('Test') {
      steps {
        sh 'npm test'
      }
    }

    stage('Build Dashboard') {
      steps {
        sh 'npm run report:dashboard:build'
      }
    }
  }

  post {
    always {
      archiveArtifacts artifacts: 'results/latest.json'
      archiveArtifacts artifacts: 'report-dashboard/dist/**', fingerprint: true
    }
  }
}
```

## Customização do Dashboard

Todo o código visual mora em `report-dashboard/src/`. Lá você pode alterar componentes, temas e integrações com analytics. O engine principal se limita a persistir o JSON.

- Ajuste estilos em `report-dashboard/src/styles/`.
- Adicione widgets novos em `report-dashboard/src/components/`.
- Atualize `report-dashboard/astro.config.mjs` para mudar base path ou integrações.

## Checklist Rápido

- [x] Rode os testes (`npm test`) → garante `results/latest.json` atualizado.
- [x] Opcional: `npm run report:dashboard:build` para gerar versão estática.
- [x] Publique os artefatos desejados (JSON e/ou build estático).
- [x] Compartilhe o link do dashboard ou anexe o JSON no MR/PR.
