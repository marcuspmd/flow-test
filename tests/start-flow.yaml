# Usaremos localhost:8080, uma API pública excelente para testar clientes HTTP.
node_id: "httpbin-test"
suite_name: "Fluxo de Teste com localhost:8080"

metadata:
  priority: "medium"
  tags: ["basic", "smoke", "httpbin", "getting-started"]
  description: "Basic flow test demonstrating core engine functionality"

# URL base para todas as requisições.
base_url: "{{httpbin_url}}"

# Variáveis locais que podem ser usadas dentro desta suite apenas.
variables:
  user_id: 123
  user_name: "alpha_user"

# Variáveis que serão exportadas globalmente como httpbin-test.captured_username e httpbin-test.auth_token
exports: ["captured_username", "auth_token"]

# A lista de etapas do nosso fluxo de teste.
steps:
  # Etapa 1: Enviar dados e "simular" a captura de um token.
  - name: "Enviar dados via POST e capturar valores"
    request:
      method: POST
      url: "/post" # Concatena com base_url -> {{httpbin_url}}/post
      headers:
        Content-Type: "application/json"
        X-Custom-Header: "Meu-Teste"
      body:
        name: "{{user_name}}" # Usa uma variável
        id: "{{user_id}}"
        grant_type: "password"

    # Validações (Assertions) para esta etapa.
    assert:
      status_code: 200

    # O localhost:8080/post retorna o corpo enviado dentro de um campo 'json'.
    # Vamos capturar o nome de usuário que enviamos de volta da resposta.
    capture:
      captured_username: "body.json.name"
      # Simulando a captura de um token estático para o próximo passo.
      auth_token: "body.headers.Host" # Apenas para ter um valor para usar

  # Etapa 2: Fazer uma requisição GET usando um valor capturado.
  - name: "Buscar dados usando o token capturado"
    request:
      method: GET
      url: "/get"
      headers:
        # Usa a variável capturada na etapa anterior.
        Authorization: "Bearer {{auth_token}}"
        X-User-Name: "{{captured_username}}"

    assert:
      status_code: 200
